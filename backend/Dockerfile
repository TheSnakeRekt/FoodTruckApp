FROM node:20
RUN mkdir -p /app
RUN npm install -g npm@10.4.0
WORKDIR /app
COPY src /app/src
COPY ./*.ts /app
COPY ./package.json /app
COPY ./tsconfig.json /app

ARG REDIS_CON_URL
ARG API_KEY
ARG PORT
ARG REDIS_HOST
ARG REDIS_PORT
ARG REDIS_EXPIRE_TIME
ARG REPORT_BASE_PATH

ARG DB_HOST 
ARG DB_PORT 
ARG DB_USER 
ARG DB_PASSWORD 
ARG DB_SSL
ARG JWT_SECRET

ENV API_KEY $API_KEY
ENV PORT $PORT
ENV REDIS_HOST $REDIS_HOST
ENV REDIS_PORT $REDIS_PORT
ENV REDIS_EXPIRE_TIME $REDIS_EXPIRE_TIME
ENV REPORT_BASE_PATH $REPORT_BASE_PATH
ENV JWT_SECRET $JWT_SECRET

ENV DB_HOST $DB_HOST
ENV DB_PORT $DB_PORT
ENV DB_USER $DB_USER
ENV DB_PASSWORD $DB_PASSWORD
ENV DB_SSL $DB_SSL

RUN npm i
RUN npm run build
CMD npm run start
